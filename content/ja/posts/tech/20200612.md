---
title: "Cookieとセッションについて"
date: 2020-06-12T18:26:30+09:00
lastmod:
draft: false
tags:
  - Cookie
  - セッション
categories:
  - その他
image: images/languages/terminal.png
series:
  - 技術関連
  - メモ
---

### Web ストレージ

- ローカルストレージ（ブラウザを閉じても残る）
  - ずっと保存したい（情報を与えっぱなしみたいな？？）
- セッションストレージ（サーバー関係ない。ブラウザを閉じると消える）

### <span class="emojify">:cookie:</span>ストレージ（ブラウザを閉じても残る）

- サーバーにデータを飛ばせる（サーバー側からも取得したい値）

この辺のデータはブラウザ / ドメインの中で完結している。  
サーバーレスとかいうのはローカルストレージとかそのへんを使えばできるのか？？

データをとりあえず保存している

レスポンスヘッダの Set-Cookie ヘッダから name, value を渡す。これは何でも渡せる。  
ブラウザ「おー、これをクッキーに入れとけばええんか」

### セッション

あなたはだあれ？？「おいおいさっき会っただろー俺だよ俺」  
同一であることを確認！

- ブラウザ
  - Cookie ストレージの中の SessionID（value）に保存する
- サーバー
  - SessionID を見て「あ、あのときのお前かあ」

セッションテーブルはセッション ID からユーザー ID を特定するためのもの！session_id と user_id を紐付ける  
サーバー「このセッション id を持つお前は〇〇だな / 登録していないから知らねえわ」（名前は知らないけど、さっき見たお前だな、っていうのはわかる）

### 保存の仕方

- cookie_store（rails のデフォルト）
  - クッキーにテーブルの情報（セッション ID もユーザー ID も）が全部はいってるよ（だって入れる場所がないんだもん）
- redis
  - クッキーでセッション ID だけ扱う。他のデータは redis で持つ（これなら漏れても安全）

以下は cookie_store の話 ↓  
だから、`session`（ブラウザの Cookie の対応する key の value: session のデータ）を取得するとめっっちゃいろいろデータが入っている。  
`session[:user_id]`っていうのはその中の`user_id`を取得しているだけ（他のデータの取り方と変わらない）  
で、`session[:hoge] = 'foo'`とかで値を入れることも可能

クッキーストアだと、そもそも情報全てをブラウザ側に持たれてしまうので、サーバー側からログアウトさせるということができない  
サーバーでセッションを管理していると、セッションテーブルを削除することで強制ログアウトさせることができる

ブラウザの<span class="emojify">:cookie:</span>はブラウザを閉じても保存される（付与するときに期限を決めておくことはできる）  
初回だけ出るポップアップとかも<span class="emojify">:cookie:</span>を使って実現できる
